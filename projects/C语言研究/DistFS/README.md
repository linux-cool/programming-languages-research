# DistFS - 分布式文件系统研究项目

## 项目概述

DistFS是一个基于C语言实现的轻量级分布式文件系统，旨在研究分布式存储的核心技术和实现原理。该项目实现了文件的分布式存储、副本管理、一致性保证和故障恢复等关键功能。

## 项目状态

- [x] 项目架构设计
- [x] 需求分析文档
- [x] 核心功能实现
- [x] 网络通信模块
- [x] 存储节点实现
- [x] 客户端API
- [x] 配置管理系统
- [x] 日志系统
- [x] 测试用例编写
- [ ] 元数据服务器
- [ ] 完整集成测试
- [ ] 性能优化
- [ ] 文档完善

## 项目目标

### 核心功能
1. **分布式存储**: 文件自动分片存储到多个节点
2. **副本管理**: 支持可配置的副本数量和副本放置策略
3. **一致性保证**: 实现强一致性的文件操作
4. **故障恢复**: 节点故障时的自动恢复和数据重建
5. **负载均衡**: 智能的数据分布和访问负载均衡

### 技术特性
- **高性能**: 基于C语言实现，优化内存和网络I/O
- **可扩展**: 支持动态添加和移除存储节点
- **容错性**: 多副本机制保证数据安全
- **简洁性**: 清晰的架构设计，易于理解和扩展

## 系统架构

### 组件设计
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Client API    │    │  Metadata Node  │    │  Storage Node   │
│                 │    │                 │    │                 │
│ - File Ops      │◄──►│ - File Metadata │◄──►│ - Data Storage  │
│ - Directory Ops │    │ - Node Registry │    │ - Replication   │
│ - Cache         │    │ - Load Balance  │    │ - Health Check  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 核心模块
1. **客户端模块** (`client.c`): 提供文件系统API接口
2. **元数据服务** (`metadata_server.c`): 管理文件元数据和节点信息
3. **存储节点** (`storage_node.c`): 负责数据存储和副本管理
4. **网络通信** (`network.c`): 节点间通信协议实现
5. **一致性协议** (`consensus.c`): 实现分布式一致性算法
6. **故障检测** (`failure_detector.c`): 节点健康监控和故障恢复

## 技术规范

### 文件分片策略
- **固定大小分片**: 默认64MB分片大小
- **哈希分布**: 使用一致性哈希算法分布数据
- **副本策略**: 默认3副本，支持配置

### 网络协议
- **传输协议**: TCP/UDP混合，控制消息用TCP，数据传输用UDP
- **消息格式**: 自定义二进制协议，支持压缩和加密
- **心跳机制**: 定期健康检查和状态同步

### 一致性模型
- **强一致性**: 写操作需要多数副本确认
- **最终一致性**: 读操作支持就近访问
- **冲突解决**: 基于时间戳的版本控制

## 实现计划

### Phase 1: 基础框架
- [x] 项目结构设计
- [ ] 网络通信模块
- [ ] 基础数据结构
- [ ] 配置管理系统

### Phase 2: 核心功能
- [ ] 元数据服务实现
- [ ] 存储节点实现
- [ ] 文件分片和副本管理
- [ ] 客户端API接口

### Phase 3: 高级特性
- [ ] 一致性协议实现
- [ ] 故障检测和恢复
- [ ] 负载均衡优化
- [ ] 性能监控和调优

### Phase 4: 测试和优化
- [ ] 单元测试覆盖
- [ ] 集成测试验证
- [ ] 性能基准测试
- [ ] 文档完善

## 性能目标

### 吞吐量指标
- **写入性能**: 单节点 > 100MB/s
- **读取性能**: 单节点 > 200MB/s
- **并发连接**: 支持 > 1000 并发客户端
- **延迟要求**: 小文件操作 < 10ms

### 可靠性指标
- **数据持久性**: 99.999999999% (11个9)
- **系统可用性**: 99.99% (4个9)
- **故障恢复**: < 30秒自动恢复
- **数据一致性**: 强一致性保证

## 开发环境

### 编译要求
- **编译器**: GCC 9+ 或 Clang 10+
- **标准**: C11/C18
- **依赖库**: pthread, libevent, zlib
- **构建工具**: CMake 3.15+

### 测试环境
- **操作系统**: Linux (Ubuntu 20.04+, CentOS 8+)
- **网络**: 千兆以太网
- **存储**: SSD推荐
- **内存**: 最小4GB，推荐8GB+

## 项目文件结构

```
DistFS/
├── README.md                 # 项目说明文档
├── CMakeLists.txt           # 构建配置
├── src/                     # 源代码目录
│   ├── common/              # 公共模块
│   │   ├── network.c        # 网络通信
│   │   ├── utils.c          # 工具函数
│   │   └── config.c         # 配置管理
│   ├── client/              # 客户端
│   │   ├── client.c         # 客户端API
│   │   └── cache.c          # 客户端缓存
│   ├── metadata/            # 元数据服务
│   │   ├── metadata_server.c # 元数据服务器
│   │   └── file_registry.c   # 文件注册表
│   ├── storage/             # 存储节点
│   │   ├── storage_node.c   # 存储节点
│   │   └── replication.c    # 副本管理
│   └── consensus/           # 一致性协议
│       ├── raft.c           # Raft算法实现
│       └── failure_detector.c # 故障检测
├── include/                 # 头文件目录
├── tests/                   # 测试代码
├── docs/                    # 详细文档
├── scripts/                 # 构建和部署脚本
└── examples/                # 使用示例

```

## 贡献指南

### 代码规范
- 遵循Linux内核代码风格
- 函数名使用下划线命名法
- 详细的注释和文档
- 完整的错误处理

### 提交规范
- 清晰的提交信息
- 单一功能的提交
- 包含相应的测试用例
- 更新相关文档

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 联系方式

- 项目维护者: [Your Name]
- 邮箱: [your.email@example.com]
- 问题反馈: GitHub Issues

---

**注意**: 这是一个研究性项目，主要用于学习分布式系统的设计和实现原理。生产环境使用请谨慎评估。
